1. # 技术方案

   ## 方案：

   1. ### ess弹性扩容

      1. 根据现有的node label对新增的资源进行分组:
         1. node/type=AIDATA
         2. node/type=AIGPU
         3. node/type=AIGPU2
         4. node/type=AIASR
      2. 对资源池中新增的nonde添加统一污点
         1. key: cronhpa
            value: paas
            effect: NoExecute
      3. 合理配置伸缩阈值以及精磨时间

   2. ### 安装测试Cronhpa

      1. pre环境安装Cronhpa
      2. 部署cronhpa以及相关的Deployment,保证ess正常伸缩

   3. ### 编写Java sdk调用Cronhpa

      1. 参照CRD RestAPI接口规范编写Cronhpa相关操作的API
      2. 代码规范参照CoreApi

   4. ### 水平伸缩Deployment

      水平伸缩不会改变原有的Deployment而是创建一个新的Deployment,目前

      1. 复制原有的Deployment
      2. 添加资源池污点容忍
      3. 部署Cronhpa以及新的Deployment({Deployment-name}-cronhpa

   ​      水平伸缩的Deployment会添加label  cronhpa=paas

   1. ### 弹性伸缩业务代码

      1. 弹性伸缩增删改查

   2. ### 资源回收

      标签以及容忍存放在'ailab_paas_dictionary'表中:

      ```
      
      ```

      

      1. 当原Deployment删除时处理Cronhpa任务以及新创建的Deployment
      2. 确保ess资源池释放

   3. ### Deployment权限控制

      通过弹性扩容创建出来的Deployment后缀名会添加-cronhpa该Deployment只能查看无法修改

      1. 禁用删除/伸缩/重新部署/HPA扩容/配置告警等

   4. ### Deployment删除/修改消息发送

      当业务的Deployment删除时发送消息通知将Cronhpa规则以及Deployment删除

      1. 创建接口接收变化情况
      2. 修改cronhpa所属的Deployment

   5. ### 负载均衡名称修改

      去除Deployment自动生成的随机数 使用前缀进行匹配

   6. ### 监控节点添加容忍

   7. ### 负载策略修改

   ​     根据service算权重，然后从一个service对应的pod组内轮询选择一个server。